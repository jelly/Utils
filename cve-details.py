#!/usr/bin/python

import argparse
import re

import requests


def get_cve_data(cve):
    url = 'https://access.redhat.com/labs/securitydataapi/cve/{}'
    r = requests.get(url.format(cve))
    if r.status_code == 404:
        print('CVE not found')
        return
    elif r.status_code != 200:
        print('Unable to retrieve CVE data')
        return

    data = r.json()
    print('Description:')
    print('\n'.join(d.strip() for d in data['details']))
    if 'references' in data:
        print('\nReferences:')
        print('\n'.join(r.strip() for r in data['references']))



def main():
    parser = argparse.ArgumentParser(description='CVE information scraper.')
    parser.add_argument('--cve', type=str, help='The CVE Identifier')
    args = parser.parse_args()

    cve_id_regex = r'^(CVE\-\d{4}\-\d{4,})$'

    if re.match(cve_id_regex, args.cve):
        get_cve_data(args.cve)
    else:
        print('Not a valid CVE')


if __name__ == "__main__":
    main()
